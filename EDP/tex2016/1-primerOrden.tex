\chapter{Ecuaciones de primer orden}

\section{Modelo de un atasco}

	Vamos a empezar con un modelo sencillo. Observemos el fenómeno del embotellamiento fantasma, el cual tiene una ecuación bastante sencilla. Veamos como se generan esos atascos y como se disipan.

	Estudiaremos una función que nos de la densidad de coches en un punto, en el tiempo.

	$$u(x,t) = \text{densidad}$$

	Observemos un modelo muy simple en el que solo hay un carril y los coches fluyen solo en una dirección.

	(DIBUO DE LA RECTA CON FLECHA HACIA LA DERECHA)

	La variación en el número de coches de un intervalo será:

	$$ \frac{d}{dt} \int^{x+h}_{x} u(s,t) ds = \int^{x+h}_{x} u_t(s,t) ds $$

	Esto equivale a al número de coches que entran por x menos los que salen por x + h. Es decir, tenemos un flujo:

	$$\text{Flujo: } q(u, x, t)$$

	Si suponemos que nos fijamos en un instante lo suficientemente pequeño en un tramo pequeño podemos asumir que depende solo de $u$. En ese caso, si $q > 0$ el flujo sería hacia la derecha.

	$$ q(u(x,t)) - q(u(x+h,t)) = -( q(u(x+h,t)) -  q(u(x,t)) ) \eqexpl{Barrow} -\int^{x+h}_{x} [q(u)]_{x} $$

	Por lo tanto tendremos sistemas del tipo:

	\begin{equation*}
	\left\{
	\begin{array}{l}
	u_t + [q(u)]_{x} = 0 \\
	u(x, 0) = F(x) \quad \quad \text{dato}
	\end{array}
	\right.
	\end{equation*}

	Ahora debemos probar distintas funciones q.


	\subsection{Modelo básico}

		Tomando $q(u) = cu$.

		\begin{equation*}
		\left\{
		\begin{array}{l}
		u_t + cu_x = 0 \\
		u(x,0) = F(x)
		\end{array}
		\right.
		\end{equation*}


		Esta ecuación dice que el flujo es proporcional a la densidad. Implica que los coches se mueven con velocidad constante, a más velocidad más flujo y viceversa. Si en el instante inicial tenemos una función de la densidad respecto de las zonas del tramo, según pasa el tiempo la densidad se irá desplazando hacia la derecha manteniendo la misma forma.

		(DIBUJO)

		\textbf{Comprobación:}

		$$ u(x,t) = F(x-ct) $$
		$$ u_x(x,t) = F'(x-ct)$$
		$$u_t(x,t) = F'(x-ct)*(-c)$$

		$$ \{ u_t + cu_x = … = 0 \quad\quad u(x,0) = F(x) \} $$

		\subsubsection{Representación gráfica}


			$$u(x,t) = \text{Cte.}$$
			$$F(x - ct) = \text{Cte.}$$

			Conclusión: $x-ct = k$.


			Las soluciones dependiendo de k se desplazan por el plano siguiendo una recta de inclinación $c$. Siguiendo una fórmula del tipo $x-ct = k$. Con esto se puede obtener como avanzan los datos (densidades) respecto de un instante inicial.

			Esto son los conjuntos de nivel de las soluciones.

			(DIBUJO)



	\subsection{Otro ejemplo}

		Imaginemos un río con una velocidad constante, en el que a partir de un punto realizamos un vertido. El río tiene velocidad $v$ y en $x=0$ realizaremos una contaminación $\beta(t)$. En $t=0$ consideraremos que está limpio.

		Tenemos las ecuaciones:

		$$u_t + vu_x = 0$$
		$$u(x,0) = 0 \quad (x>0) $$
		$$u(0,t) = \beta(t), t>0$$


		Resolvemos el problema igual que antes, buscamos los conjuntos de nivel que serán rectas como nos ha salido antes. Vamos a buscar esas rectas.

		\textbf{Buscamos $x(t)$ tal que $u(x(t),t)$ sea constante}

		Derivando en t: $u_x x' + u_t = 0$ que junto con la ecuación $u_t + v u_x = 0$ nos da que $x' = v \Rightarrow x = x_0 + vt $.

		Las características saldrían \(x-vt = \text{Cte}(=x_0) \label{eq:rio_vcte}\).

		Esas son nuestras rectas conjuntos de nivel, que en este caso indicarían el frente de la contaminación, el límite a partir del cual el río sigue limpio.

		$$u(x,t) =
			\begin{cases}
				0                      & (x-vt) > 0 \\
				\beta(t - \frac{x}{v}) & (x-vt) < 0
			\end{cases}
		$$

		\begin{figure}[hbtp]
			\centering
			\inputtikz{ContaminacionRio}
			\caption{}.
			\label{fig:ContaminacionRio}
		\end{figure}

		El valor de $u(x,t)$ cuando $x-vt < 0$, se obtiene utilizando \ref{eq:rio_vcte} y tomando el punto de corte de la recta $x-c \cdot t=k$ que pasa por $(0,t^*)$:

		$$
		\begin{rcases}
			0 - vt^{*} = k \\
			x - vt = k
		\end{rcases}
		 \Rightarrow x-vt = -vt^{*} \iff t^* = \frac{x-vt}{-v} = t - \frac{x}{v}$$

		Por lo que
		$$u(x,t) = \beta(t^*) = \beta(t - \frac{x}{v}), \quad \text{ cuando } x - vt < 0$$

		De esto obtenemos una función de x en función del tiempo que nos permite saber cuándo una parte del río se contamina.

	\subsection{Ejemplo más avanzado}

		Supongamos que existe descomposición biológica:

		$$u_t + vu_x = -\gamma u$$
		$$u(x,0) = \text{Cte}$$
		$$u(0,t) = \beta$$

		(Cambiamos de variable)

		$$u_t + \gamma_u + vu_x = 0$$
		$$e^{\gamma t} u_t + e^{\gamma t} u + v e^{ \gamma t} u_x = 0 $$

		lo que es lo mismo

		$$(e^{\gamma t}u)_t + v (e^{\gamma t} u)_x$$

		Y definimos la función $W$:

		$$W = e^{\gamma t}u$$.


		Hay que comprobar cuál es el efecto del término de descomposición biológica ($-\gamma u$). ¿ $W(x,0)$ , $ W(0,t)$ ?. Esto queda como ejercicio al lector.


	\subsection{Modelo con aportación externa}

		$$u_t + vu_x = f(x,t)$$
		$$u(x,0) = F(x)$$

		Ya al no ver constante, la solución no va a ser constante a lo largo de las características, que siguen existiendo. En el caso $f = 0$ éstas daban la solución, pero ahora van a influir.


		\subsubsection{Solución 1}

			Cambio de variables:
			$$z = x-vt$$

			Lo cual hace más sencillo observar la variación temporal. Continuamos el cambio:
			$$x = z + vt$$
			$$W(z,t) = u(z+vt, t)$$

			Entonces queremos estudiar la variación de $W$ respecto del tiempo:

			$$W_t(z,t) = u_x(z + vt, t)v + u_t(z+vt, t) = f(z + vt, t)$$

			Integramos:
			$$W(z,t) = W(0,t) + \int^{t}_{0} f(z+v\tau, \tau) d\tau $$

			Lo que se entiende como el dato inicial más la suma de las aportaciones de esta función $f$ en el tiempo pasado. Ahora deshacemos el cambio de variable:

			$$u(z + vt, t) = u(z,0) + \int^{t}_{0} f(z+v\tau, \tau) d\tau$$
			$$z = x-vt$$
			$$u(x,t) = u(x-vt,0)+ \int^{t}_{0} f(x-v(t-\tau),\tau) d\tau$$

			(donde $u(x-vt,0) = F(x-vt)$)

			Esto es un milagro ya que tiene una fórmula explícita, que es poco común en EDOs y EDPs.

		\subsubsection{Solución 2}

			Vamos a descomponer el sistema en 2. Dos soluciones en las que cada una va a ser solución de dos partes del problema que nos interesan. Una del dato inicial y otra del resto.
			$$u = \phi + \psi$$

			Por un lado:
			$$
			\begin{rcases}
				\phi_t + v\phi_x = 0 \\
				\phi(x,0) = F(x)
			\end{rcases}
			\rightarrow \phi(x,t) = F(x-vt)
			$$

			Y por otro:
			$$\psi_t + v\psi_x = f(x,t)$$
			$$\psi(x,0) = 0$$

			Este problema con \concept{DUHAMEL} (la fuente externa se interpreta como una fuente de datos iniciales, se cambia el cero de la segunda ecuación de las anteriores) se puede interpretar como que tenemos una función que transporta el sistema.

			\begin{figure}[hbtp]
				\centering
				\inputtikz{interseccionCaracteristica}
				\caption{}
				\label{fig:interseccionCaracteristica}
			\end{figure}
				
			

			$$\xi_t + v\xi_x = 0$$
			$$\xi(x,s) = f(x,s)$$

			Continuamos:
			\(\xi(x,t) = f(x^*,s) \label{eq:modelo_aportacion_externa_1}\)
			$$
			\begin{rcases}
				x-vt = k \\
				x^* - vs = k
			\end{rcases}
			 \rightarrow x-vt = x^* - vs
			$$
			\( x-v(t-s) = x^{*} \label{eq:modelo_aportacion_externa_2} \)

			Y sustituimos \ref{eq:modelo_aportacion_externa_2} en \ref{eq:modelo_aportacion_externa_1}
			$$\xi(x,t) = f(x - v(t-s), s)$$


			Tenemos la solución correspondiente de un aporte instantáneo en el punto $t$. Por lo tanto la solución será la suma de todos los aportes instantáneos:

			$$\Rightarrow \psi(x,t) = \int^{t}_{0} f(x-v(t-s),s) ds $$

			Aunque hemos hecho un montón de asunciones que tendremos que comprobar en algún momento.

	\subsection{Modelo de tráfico más realista}

		No hemos tenido en cuenta que la velocidad de los coches no es totalmente proporcional a la densidad. Si ésta baja mucho, los coches llegan a pararse. Hay una densidad máxima donde el tráfico quedará totalmente estancado (los coches pegados).

		\begin{figure}[hbtp]
			\centering
			\inputtikz{parabola}
			\caption{}
			\label{fig:parabola}
		\end{figure}

		Una función más realista sería una parábola. Si no hay coches no pasa ninguno, pero a partir de un punto cuantos más coches, menos rápido van, y menos pasan.

		$$ q(u) = Au (B-u) = ABu - Au^{2} $$

		Veamos su ecuación:
		$$u_t + [q(u)]_x = 0$$
		$$ … $$
		$$ u_t + (AB - 2Au) u_x = 0 $$

		La velocidad va a ser dependiente de la densidad.

		Nos saldrán características cuya pendiente dependa del valor en el tiempo inicial. Si divergen no habrá problema, pero si convergen, habrá puntos donde rectas de densidad 2 (por ejemplo) cortarán con rectas de densidad 1. Esto se entiende como coches que van más rápido que se encuentran con coches que van más lentos y se ven obligados a frenar.


		Para simplificar los cálculos de este modelo asumamos que $A = B = 1$. Por lo tanto ahora estudiaremos:

		\begin{equation*}
		\left\{
		\begin{array}{l}
		u_t + (1-2u)u_{x} = 0 \\
		u(x, 0) = F(x) \quad \quad \text{dato}
		\end{array}
		\right.
		\end{equation*}

		Obtengamos las características (curvas de nivel para esa solución). Con la regla de la cadena tenemos:

		$$u_x x' + u_t = 0 \text{ a lo largo de la característica}$$

		Como $u = k$

		$$x' = 1 - 2u = 1 - 2k$$

		$$x = x_0 + (1-2k)t$$

		Características:

		\( x - (1-2k)t = x_0\quad,\quad k=F(x_0)  \label{eq:caracteristicas_realistas} \)

		Me fijo en un punto en el instante inicial. Con el valor de ese punto calculamos la pendiente y con la pendiente calculamos la evolución. A lo largo de las caracterísitcas el valor del dato se mantiene. En este caso las caracteristicas no son paralelas.

		\begin{figure}[hbtp]
			\centering
			\inputtikz{rectasDivergentes}
			\caption{}
			\label{fig:rectasDivergentes}
		\end{figure}

		Veamos algunos ejemplos:

		\begin{example}[Semáforo]

			$$F(x) =
			\begin{cases}
				1 & x > 0 \\
				0 & x < 0
			\end{cases}
			$$

			\begin{figure}[hbtp]
				\centering
				\inputtikz{semaforoCerrado}
				\caption{Semáforo cerrado en $t=0$}
				\label{fig:semaforoCerrado}
			\end{figure}

			Y en $t=0$ se abre el semáforo. 

			En la sección izquierda: $\Rightarrow F = 1 \Rightarrow x + t = \text{Cte} \Rightarrow x = -t $.

			En la derecha: $F = 0 \Rightarrow x-t = \x_0$.

			\begin{figure}[hbtp]
				\centering
				\inputtikz{caracteristicasSemaforo}
				\caption{}
				\label{fig:caracteristicasSemaforo}
			\end{figure}

			Vemos que las características se abren y se separan desde $x=0$ hacia afuera.

			Por lo tanto las características no nos dan información en la región $x \in (-t,t)$ ya que ninguna característica pasa por ellas.

			\begin{figure}[hbtp]
				\centering
				\inputtikz{semaforoT}
				\caption{Instante $t=T$}
				\label{fig:semaforoT}
			\end{figure}

			Esto pasa porque no está definida la función en el $0$. Si lo estuviera podríamos intentar sacar infinitas características desde el 0 que rellenaran la zona en la que no tenemos información.

		\end{example}

		\begin{example}[Frenazo]

			Imaginemos ahora dos zonas, una con densidad de coches baja y otra con densidad alta (se encuentran con un atasco)

			\begin{figure}[hbtp]
				\centering
				\inputtikz{modeloAtasco}
				\caption{}
				\label{fig:modeloAtasco}
			\end{figure}

			$$F(x) =
			\begin{cases}
				1/5 & x < 0 \\
				2/3 & x > 0
			\end{cases}
			$$

			Dibujamos las características con \ref{eq:caracteristicas_realistas}.

			\begin{figure}[hbtp]
				\centering
				\inputtikz{ondaChoque}
				\caption{}
				\label{fig:ondaChoque}
			\end{figure}

			Vemos en este dibujo casos en los que cuando recorremos una recta característica con valor $\frac{1}{5}$ nos encontramos con otra de valor $\frac{2}{3}$. Momento en el cual se produce el frenazo.

			Fijando $T$ podemos mirar el valor de cada $x$ trazando su correspondiente característica. Ahí es donde nos encontraremos los puntos en los que las rectas cortan. La sucesión de puntos de corte en función de $t$ es la curva que nos interesa. Se corresponde a la función que dictamina como se van encendiendo las luces rojas de los coches según se van parando al llegar a un atasco.

		\end{example}

		Intentemos resolver ambos en general. Volvemos a la equación:

		$$u_t +m [q(u)]_x = 0$$

		Como tiene derivadas y nos impide trabajar con funciones con discontinuidades intentaremos ver el origen de esta hasta que no haya derivadas y no hayamos hecho hipótesis de regularidad. Esta ecuación venía de una integral:

		$$\frac{1}{h} \int^{x+h}_{x} u_t + [q(u)]_x = 0$$

		que a su vez venía de:

		$$\frac{d}{dt} \int^{x+h}_{x} u = q(u(x))-q(u(x+h))$$

		$u$ es $C^1$ a trozos con discontinuidad de salto en $x=s(t)$. Así que llegamos al problema:

		\textbf{Hallar $s(t)$}

		\begin{figure}[hbtp]
			\centering
			\inputtikz{discontinuidadAtasco}
			\caption{}
			\label{fig:discontinuidadAtasco}
		\end{figure}

		% A partir de aquí está bastante mal muy probablemente
		

		En el intervalo $[x_1,x_2]$:

		$$\frac{d}{dt} \left[ \int^{s(t)}_{x_1} u(x,t) dx + \int^{x^2}_{s(t)} u(x,t) dx \right] = q(u(x_1)) - q(u(x_2))$$


		$$ \text{¿ } \frac{d}{dt} \int^{s(t)}_{x_1} u(x,t) \dif x \text{ ?} $$

		Tomemos:

		$$G(z,t) = \int^z_{x_1}1 u(x,z) \dif x $$

		$$G_z = u(z,t) $$

		$$G_z = \int^{z}_{x_1} u_t(x,z) \dif x $$

		$$\int^{s(t)}_{x_1} u(x,t) dt = G(s(t),t)$$


		\textbf{Notación}

		$$[u(s(t),t)]^{-} = \lim_{x \to s(t)^{-}} u(x, s(t)) $$

		\textit{Queda para el lector hacer lo mismo con la otra integral.}

		Si realizamos lo mismo con la otra integral llegamos a esta \textbf{conclusión}:

		$$([u(s(t),t)]^{-} - [u(s(t),t)]^{+}) s'(t) +  \int^{s(t)}_{x_1} u_t(x,t) dx + \int^{x^2}_{s(t)} u_t(x,t) dx = q(u(x_1,t)) - q(u(x,t)) $$

		Ahora llevamos $x_1$ y $x_2$ tender a $s(t)$.

		Hacemos $x_1 \rightarrow s(t)^{-}$,$x_2 \rightarrow s(t)^{+}$.


		\textbf{Resultado:}

		$$(u(s(t),t)^{-} - u(s(t),t)^{+}) s'(t) = q(u(s(t),t)^{-}) - q(u(s(t),t)^{+})$$

		$$s'(t) = \frac{q(u(s(t),t)^{-}) - q(u(s(t),t)^{+})}{u(s(t),t)^{-} - u(s(t),t)^{+}} $$

		Lo cual resulta ser nuestra equación del shock.

		(FALTA NOMBRE TEOREMA EXTRAÑO)

		(DIBUJO DE LA ONDA DE SHOCK OTRA VEZ)

		Para obtener la curva calculamos:

		Salto en u: $2/3 - 1/5 = 7/15$

		Salto en q: $2/3(1-2/3) - 1/5(1-1/5)$

		$$q(u) = u (1-u)$$ = 2/9 - 4/25 = 14/225


		Entonces:

		$$s'(t) = \frac{\text{Salto q}}{\text{Salto u}} = \frac{\frac{14}{225}}{\frac{7}{15}} = \frac{14.15}{7.225} \equiv \alpha \quad(>0)$$

		$$s(0) = 0 \Rightarrow s(t) = \alpha t $$

		Por lo que la onda de choque sigue $x = s(t) = \alpha t$.

		(DIBUJO RECTA)








